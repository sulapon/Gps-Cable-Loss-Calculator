<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>è¨ˆç®—å·¥å…·</title>
<meta name="theme-color" content="#071026">
<style>
  /* --- çµ±ä¸€åŸºç¤é¢¨æ ¼ --- */
  :root{
    --bg-0:#050a16; --bg-1:#0b1526;
    /* é¡è‰²å„ªåŒ–ï¼šæ¨™ç±¤æ›´äº®ï¼Œè¼”åŠ©æ–‡å­—æ›´æŸ”å’Œ */
    --muted:#a8b3c3; /* æŸ”å’Œç°è— */ 
    --label:#85c9ff; /* æ˜äº®è—è‰² */
    --title:#ffe58f;
    --value:#5ff0d5; 
    --accent1:#5ff0d5; 
    --accent2:#79a8ff;
    --glass: rgba(255,255,255,0.06);
    --shadow: 0 4px 12px rgba(0,0,0,0.40);
    font-size:24px;
    /* GPS ç‰¹æœ‰é¡è‰²è®Šæ•¸ */
    --gps-dist-value: var(--accent1); 
    --gps-bearing-value: #ffd369;
    --gps-pitch-value: #bb66ff;
    --gps-error-border: #dc3545; 
  }
  *{box-sizing:border-box}
  body{
    margin:0; padding:0;
    background:linear-gradient(180deg,var(--bg-0),var(--bg-1));
    color:#e8eef5;
    font-family:Inter, 'Noto Sans TC', system-ui;
    line-height:1.3;
  }

  /* ç§»é™¤æ¨™é¡Œå¾Œï¼Œä¿æŒ header åº•éƒ¨é‚Šç•Œä»¥åˆ†éš”å…§å®¹ */
  header{padding:6px 10px; background-color: var(--bg-1); border-bottom: 1px solid rgba(255,255,255,0.08); height: 30px;} 

  h1{
    /* H1 æ¨™ç±¤å…§å®¹å·²ç§»é™¤ */
    display: none; 
  }

  main{padding:6px; max-width:880px; margin:0 auto;}

  .card{
    background:rgba(255,255,255,0.02);
    padding:6px 8px;
    border-radius:10px;
    margin-bottom:6px;
    box-shadow:var(--shadow);
    border:1px solid rgba(255,255,255,0.03);
  }

  .section-title{
    color:var(--title);
    font-size:18px;
    font-weight:700;
    margin-bottom:4px;
    display:block;
  }

  .form-grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:5px;
    align-items:end;
  }

  label{
    color:var(--label);
    font-size:15px;
    margin-bottom:1px;
    display:block;
  }

  /* è¼¸å…¥æ¡†èˆ‡é¸æ“‡å™¨é¢¨æ ¼çµ±ä¸€ */
  input,select{
    width:100%;
    padding:5px 8px;
    font-size:17px;
    color:var(--value);
    background:transparent;
    border-radius:6px;
    border:1px solid rgba(255,255,255,0.15); 
  }
  .gps-container input[type="number"], .gps-container input[type="text"] {
    padding: 3px 5px;
    font-size: 14px;
    border: 1px solid rgba(255,255,255,0.2); 
  }


  .controls{
    margin-top:2px;
    display:flex;
    gap:5px;
  }

  /* æŒ‰éˆ•é¢¨æ ¼çµ±ä¸€ */
  .btn{
    background:linear-gradient(90deg,var(--accent1),var(--accent2));
    border:0;
    padding:5px 8px;
    border-radius:6px;
    font-weight:700;
    font-size:16px;
    color:#022;
    cursor:pointer;
  }
  .btn.ghost{
    background:transparent;
    border:1px solid rgba(255,255,255,0.12);
    color:#e8eef5;
  }
  .btn.clear{
    background:#dd4444;
    color:white;
    border-radius:6px;
  }

  /* è¨ˆç®—æŒ‰éˆ•è¡Œ */
  .btn-row{ 
    display:flex; flex-wrap:nowrap; justify-content:space-between; align-items:center; gap:12px; width:100%; box-sizing:border-box; 
  }
  .btn-row .btn{ 
    flex:1 1 0; text-align:center; white-space:nowrap; 
  }

  #liveInputs{
    margin-top:3px;
    font-size:14px;
    color:var(--muted);
  }

  /* è¡¨æ ¼é¢¨æ ¼çµ±ä¸€ */
  table{
    width:100%;
    border-collapse:collapse;
    margin-top:6px;
    font-size:16px;
  }
  thead th{
    color:var(--label);
    padding:3px 3px;
    border-bottom:1px solid rgba(255,255,255,0.06);
    text-align:center;
  }
  tbody td{
    padding:4px 3px;
    border-bottom:1px solid rgba(255,255,255,0.03);
    text-align:center;
  }

  .name{
    color:#ffd369; 
    font-weight:700;
    white-space:nowrap;
  }
  th:first-child, td:first-child{
    width:32%;
    text-align:left;
  }

  .value, .percent{
    color:var(--value);
    font-weight:800;
    font-variant-numeric:tabular-nums;
  }

  .small-note{
    font-size:13px;
    margin-top:3px;
    color:var(--muted);
  }

  @media (max-width:640px){
    .form-grid{grid-template-columns:1fr;}
  }
  
  /* --- å°è¦½åˆ— (Tabs) æ¨£å¼ --- */
  .tabs{
    display:flex;
    margin-bottom: 6px;
    overflow-x: auto;
    border-bottom: 1px solid rgba(255,255,255,0.06);
  }
  .tab-button{
    flex-shrink: 0;
    padding: 8px 15px;
    margin: 0 4px;
    background: transparent;
    border: 0;
    color: var(--muted);
    font-size: 16px;
    cursor: pointer;
    font-weight: 600;
    border-radius: 8px 8px 0 0;
    transition: all 0.2s ease;
  }
  .tab-button.active{
    background: var(--glass);
    color: var(--title);
    border-bottom: 2px solid var(--accent1);
  }
  .tab-content{
    display: none;
    padding-top: 5px;
  }
  .tab-content.active{
    display: block;
  }
  
  /* --- GPS è¨ˆç®—å™¨å„ªåŒ–æ¨£å¼ --- */
  .gps-container { padding: 0; }
  .gps-tip { color: var(--label) !important; font-size: 13px !important; margin: 0 0 5px 0; }
  .gps-ig { margin-bottom: 6px; padding: 6px 8px; border: 1px solid rgba(255,255,255,0.05); border-radius: 8px; background-color: rgba(255,255,255,0.02); }
  .gps-loc-header { margin-bottom: 4px; font-weight: bold; color: var(--title); font-size: 16px; display: flex; align-items: center; justify-content: space-between; }
  .gps-loc-header input { max-width: 80px; font-size: 14px; margin-left: 8px; text-align: center; flex-shrink: 0; }
  .gps-loc-header span { color: var(--muted); font-size: 13px; flex-shrink: 0; margin-left: 4px; }
  .gps-cg { border: 1px solid rgba(255,255,255,0.05); padding: 4px; margin-bottom: 4px; border-radius: 6px; }
  .gps-cl { font-weight: bold; color: var(--label); display: block; margin-bottom: 2px; font-size: 13px; }

  /* åé€²åˆ¶è¼¸å…¥è¡Œ */
  .gps-ddr { display: flex; align-items: center; margin-bottom: 2px; }
  .gps-ddr input { flex-grow: 1; text-align: left; }
  .gps-ddr span { color: var(--muted); font-size: 12px; margin-right: 4px; flex-shrink: 0; }
  
  /* DMS è¼¸å…¥è¡Œ */
  .gps-dmsr { display: flex; align-items: center; justify-content: space-between; gap: 4px; }
  .gps-dmsf { display: flex; align-items: center; flex: 1; min-width: 0; }
  .gps-dmsf input { text-align: center; margin-right: 3px; max-width: none; flex-grow: 1; min-width: 30px; } 
  .gps-dmsf:nth-child(1) input { flex: 2; } 
  .gps-dmsf:nth-child(2) input { flex: 1.5; } 
  .gps-dmsf:nth-child(3) input { flex: 2.5; } 
  .gps-dmsr span { color: var(--muted); font-size: 12px; margin-right: 0; flex-shrink: 0; }
  
  /* é«˜åº¦è¡Œ */
  .gps-er { display: flex; align-items: center; justify-content: space-between; margin-top: 5px; padding-top: 5px; border-top: 1px dashed rgba(255,255,255,0.08); }
  .gps-er input { max-width: 120px; text-align: right; }
  .gps-er label { font-size: 13px; margin-right: 8px; flex-shrink: 0; color: var(--label); }
  .gps-er span { font-size: 13px; flex-shrink: 0; color: var(--muted); margin-left: 4px; }

  /* æ¸…é™¤æŒ‰éˆ• (GPS) */
  .gps-cb { background: none; border: none; color: #ff6347; font-size: 16px; cursor: pointer; padding: 0 5px; line-height: 1; margin-left: auto; font-weight: bold; opacity: 0.8; }

  /* GPS è¨ˆç®—æŒ‰éˆ• */
  #gpsCalcBtn { 
    width: 100%; padding: 10px; 
    background: linear-gradient(90deg, #4caf50, #8bc34a); 
    color: #022; 
    border: none; 
    border-radius: 6px; 
    font-size: 17px; 
    font-weight: bold;
    cursor: pointer; 
    margin-top: 8px; 
    box-shadow: var(--shadow);
  }

  /* GPS çµæœé¡¯ç¤º */
  #gpsRes { 
    margin-top: 8px; padding: 12px; 
    border: 2px solid var(--accent2); 
    border-radius: 8px; 
    background-color: rgba(121, 168, 255, 0.05); 
    font-size: 15px; 
    font-weight: 500; 
    text-align: left; 
    color: #e8eef5; 
  }
  #gpsRes p { margin: 4px 0; } 
  #gpsRes hr { border: 0; border-top: 1px solid rgba(255,255,255,0.08); margin: 4px 0; }

  /* GPS çµæœæ•¸å€¼é¡è‰²èˆ‡å¤§å° */
  .v-dist, .v-bearing, .v-pitch-value {
    font-weight: 900 !important;
    font-size: 1.1em; 
  }
  .v-dist { color: var(--gps-dist-value) !important; } 
  .v-bearing { color: var(--gps-bearing-value) !important; } 
  .v-pitch-value { color: var(--gps-pitch-value) !important; } 
  .gps-rpn { font-size: 12px !important; color: var(--muted); margin-left: 8px; margin-top: 0; margin-bottom: 2px !important; }
  
  /* GPS éŒ¯èª¤è¨Šæ¯é¢¨æ ¼ */
  .gps-error {
    border-color: var(--gps-error-border) !important;
    background-color: rgba(221, 68, 68, 0.1) !important;
    color: #ff6347 !important;
    font-weight: bold;
  }

</style>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0a4cff">
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>

</head>
<body>

<header></header>

<main>

  <div class="tabs">
    <button class="tab-button active" onclick="showTab('rf')">ğŸ“¡ å°„é »ç·šè¡°æ¸›</button>
    <button class="tab-button" onclick="showTab('gps')">ğŸŒ GPS è·é›¢/æ–¹ä½è§’</button>
  </div>

  <div id="rf-content" class="tab-content active">
    <section class="card">
      <span class="section-title">è¼¸å…¥åƒæ•¸</span>

      <div class="form-grid">
        <div>
          <label for="freq">é »ç‡ (MHz)</label>
          <input id="freq" type="number" value="900" min="0" step="1">
        </div>

        <div>
          <label for="lenInput">é•·åº¦</label>
          <input id="lenInput" type="number" value="10" min="0" step="0.01">
        </div>

        <div>
          <label for="unit">å–®ä½</label>
          <select id="unit">
            <option value="m">å…¬å°º (m)</option>
            <option value="ft">è‹±å°º (ft)</option>
          </select>
        </div>

        <div>
          <label>&nbsp;</label>
          <div class="controls">

            <div class="btn-row"><button id="calc" class="btn">è¨ˆç®—</button>
            <button id="reset" class="btn ghost">é è¨­</button>

            <button id="clear" class="btn clear">æ¸…é™¤</button></div>

          </div>
        </div>
      </div>

      <div id="liveInputs" class="small-note">è¼¸å…¥ä¸¦æŒ‰ã€Œè¨ˆç®—ã€æŸ¥çœ‹çµæœã€‚</div>
    </section>

    <section class="card">
      <span class="section-title">è¨ˆç®—çµæœï¼ˆç”±å°åˆ°å¤§ï¼‰</span>
      <div id="tableArea"></div>
    </section>
  </div>

  <div id="gps-content" class="tab-content gps-container">
    <div class="card">
      <h2 class="section-title" style="margin-top: 0;">GPS è·é›¢ã€æ–¹ä½è§’èˆ‡ä¿¯ä»°è§’è¨ˆç®—</h2>
      <p class="gps-tip">è€ƒæ…®åœ°çƒæ›²ç‡èˆ‡é«˜åº¦å·® (WGS84)</p>

      <div class="gps-ig">
          <div class="gps-loc-header">
              ğŸ“ åœ°é» A åº§æ¨™
              <input type="text" id="nameA" placeholder="åœ°å A" maxlength="5">
              <span>(åœ°å)</span>
          </div>
          
          <div class="gps-cg">
              <span class="gps-cl">ç·¯åº¦ (Latitude) - åé€²åˆ¶/DMS</span>
              <div class="gps-ddr">
                  <input type="number" id="latA" placeholder="åé€²åˆ¶æ•¸å€¼" step="any" oninput="dToDMS('latA')">
                  <span>åº¦</span>
                  <button class="gps-cb" onclick="clearCoord('latA')">âœ–</button>
              </div>
              <div class="gps-dmsr">
                  <div class="gps-dmsf"><input type="number" id="latA_deg" placeholder="åº¦" oninput="dmsToD('latA')"><span>Â°</span></div>
                  <div class="gps-dmsf"><input type="number" id="latA_min" placeholder="åˆ†" oninput="dmsToD('latA')"><span>'</span></div>
                  <div class="gps-dmsf"><input type="number" id="latA_sec" placeholder="ç§’" step="0.01" oninput="dmsToD('latA')"><span>''</span></div>
              </div>
          </div>
          
          <div class="gps-cg">
              <span class="gps-cl">ç¶“åº¦ (Longitude) - åé€²åˆ¶/DMS</span>
              <div class="gps-ddr">
                  <input type="number" id="lonA" placeholder="åé€²åˆ¶æ•¸å€¼" step="any" oninput="dToDMS('lonA')">
                  <span>åº¦</span>
                  <button class="gps-cb" onclick="clearCoord('lonA')">âœ–</button>
              </div>
              <div class="gps-dmsr">
                  <div class="gps-dmsf"><input type="number" id="lonA_deg" placeholder="åº¦" oninput="dmsToD('lonA')"><span>Â°</span></div>
                  <div class="gps-dmsf"><input type="number" id="lonA_min" placeholder="åˆ†" oninput="dmsToD('lonA')"><span>'</span></div>
                  <div class="gps-dmsf"><input type="number" id="lonA_sec" placeholder="ç§’" step="0.01" oninput="dmsToD('lonA')"><span>''</span></div>
              </div>
          </div>
          
          <div class="gps-er">
              <label for="eleA">é«˜åº¦ (Elevation)</label>
              <input type="number" id="eleA" placeholder="è«‹è¼¸å…¥æ•¸å€¼" step="0.01">
              <span>å…¬å°º (m)</span>
          </div>
      </div>

      <div class="gps-ig">
          <div class="gps-loc-header">
              ğŸ¯ åœ°é» B åº§æ¨™
              <input type="text" id="nameB" placeholder="åœ°å B" maxlength="5">
              <span>(åœ°å)</span>
          </div>
          
          <div class="gps-cg">
              <span class="gps-cl">ç·¯åº¦ (Latitude) - åé€²åˆ¶/DMS</span>
              <div class="gps-ddr">
                  <input type="number" id="latB" placeholder="åé€²åˆ¶æ•¸å€¼" step="any" oninput="dToDMS('latB')">
                  <span>åº¦</span>
                  <button class="gps-cb" onclick="clearCoord('latB')">âœ–</button>
              </div>
              <div class="gps-dmsr">
                  <div class="gps-dmsf"><input type="number" id="latB_deg" placeholder="åº¦" oninput="dmsToD('latB')"><span>Â°</span></div>
                  <div class="gps-dmsf"><input type="number" id="latB_min" placeholder="åˆ†" oninput="dmsToD('latB')"><span>'</span></div>
                  <div class="gps-dmsf"><input type="number" id="latB_sec" placeholder="ç§’" step="0.01" oninput="dmsToD('latB')"><span>''</span></div>
              </div>
          </div>
          
          <div class="gps-cg">
              <span class="gps-cl">ç¶“åº¦ (Longitude) - åé€²åˆ¶/DMS</span>
              <div class="gps-ddr">
                  <input type="number" id="lonB" placeholder="åé€²åˆ¶æ•¸å€¼" step="any" oninput="dToDMS('lonB')">
                  <span>åº¦</span>
                  <button class="gps-cb" onclick="clearCoord('lonB')">âœ–</button>
              </div>
              <div class="gps-dmsr">
                  <div class="gps-dmsf"><input type="number" id="lonB_deg" placeholder="åº¦" oninput="dmsToD('lonB')"><span>Â°</span></div>
                  <div class="gps-dmsf"><input type="number" id="lonB_min" placeholder="åˆ†" oninput="dmsToD('lonB')"><span>'</span></div>
                  <div class="gps-dmsf"><input type="number" id="lonB_sec" placeholder="ç§’" step="0.01" oninput="dmsToD('lonB')"><span>''</span></div>
              </div>
          </div>
          
          <div class="gps-er">
              <label for="eleB">é«˜åº¦ (Elevation)</label>
              <input type="number" id="eleB" placeholder="è«‹è¼¸å…¥æ•¸å€¼" step="0.01">
              <span>å…¬å°º (m)</span>
          </div>
      </div>

      <button id="gpsCalcBtn" onclick="calculate()">è¨ˆç®—ç›´ç·šè·é›¢ã€æ–¹ä½è§’èˆ‡ä¿¯ä»°è§’</button>

      <div id="gpsRes">
          é»æ“Šã€Œè¨ˆç®—ç›´ç·šè·é›¢ã€æ–¹ä½è§’èˆ‡ä¿¯ä»°è§’ã€ä»¥é¡¯ç¤ºçµæœ
      </div>
    </div>
  </div>

</main>

<script>
  // --- Tab åˆ‡æ›åŠŸèƒ½ ---
  function showTab(tabId) {
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

    document.querySelector(`.tab-button[onclick*="'${tabId}'"]`).classList.add('active');
    document.getElementById(tabId + '-content').classList.add('active');

    if (tabId === 'rf') {
      compute();
    } else if (tabId === 'gps') {
      calculate(); 
    }
  }

  // --- å°„é »ç·šè¨ˆç®—å™¨ (RF Calculator) JS ---
  const cables = [
    { name: "LMR-600", a: 0.07555, b: 0.00026 },
    { name: "TCOM-600", a: 0.080075, b: 0.000256 },
    { name: "LMR-600-UF", a: 0.09066, b: 0.000312 },
    { name: "LMR-400", a: 0.12229, b: 0.00026 },
    { name: "LMR-400-UF", a: 0.146748, b: 0.000312 },
    { name: "RG214", a: 0.21, b: 0.00126 },
    { name: "RG142", a: 0.368, b: 0.0012 }
  ];

  function calcAttenPer100ft(f,a,b){
    return a * Math.sqrt(f) + b * f;
  }
  function ftFromLength(len,unit){
    return unit === "ft" ? len : len * 3.280839895;
  }

  function powerPassPercent(db){
    return Math.pow(10, -db / 10) * 100;
  }

  function compute(){
    const f = parseFloat(document.getElementById("freq").value) || 0;
    const len = parseFloat(document.getElementById("lenInput").value) || 0;
    const unit = document.getElementById("unit").value || "m";
    const ftLen = ftFromLength(len, unit);

    document.getElementById("liveInputs").innerText =
      `${f} MHz â€¢ ${len} ${unit} (${ftLen.toFixed(2)} ft)`;

    const results = cables.map(c=>{
      const per100 = calcAttenPer100ft(f, c.a, c.b);
      const total = per100 * (ftLen / 100);

      const pass = powerPassPercent(total);
      const loss = 100 - pass;

      return {
        name: c.name,
        total: Number(total.toFixed(6)),
        pass: pass,
        loss: loss
      };
    });

    results.sort((x,y)=> x.total - y.total);

    let html =
      "<table><thead><tr>" +
      "<th>ç·šæ</th>" +
      "<th>è¡°æ¸› (dB)</th>" +
      "<th>é€šéåŠŸç‡ (%)</th>" +
      "<th>è¡°æ¸›åŠŸç‡ (%)</th>" +
      "</tr></thead><tbody>";

    results.forEach(r=>{
      html += `
        <tr>
          <td class="name">${r.name}</td>
          <td class="value">${r.total.toFixed(2)}</td>
          <td class="percent">${r.pass.toFixed(1)}</td>
          <td class="percent">${r.loss.toFixed(1)}</td>
        </tr>`;
    });

    html += "</tbody></table>";

    document.getElementById("tableArea").innerHTML = html;
  }

  document.getElementById("calc").addEventListener("click", compute);

  document.getElementById("reset").addEventListener("click", ()=>{
    document.getElementById("freq").value = 900;
    document.getElementById("lenInput").value = 10;
    document.getElementById("unit").value = "m";
    compute();
  });

  document.getElementById("clear").addEventListener("click", ()=>{
    document.getElementById("freq").value = "";
    document.getElementById("lenInput").value = "";
    document.getElementById("liveInputs").innerText = "è¼¸å…¥ä¸¦æŒ‰ã€Œè¨ˆç®—ã€æŸ¥çœ‹çµæœã€‚";
    document.getElementById("tableArea").innerHTML = "";
  });

  // --- GPS è¨ˆç®—å™¨ (GPS Calculator) JS ---
  const R_KM = 6371; 
  const tRad = a => a * (Math.PI / 180); 
  const tDeg = r => r * (180 / Math.PI); 

  // DD to DMS è½‰æ›
  const dToDMS = (id) => {
    const dd = parseFloat(document.getElementById(id).value);
    if (isNaN(dd) || document.getElementById(id).value.trim() === '') {
        ['deg', 'min', 'sec'].forEach(s => document.getElementById(id + '_' + s).value = '');
        return;
    }
    const absDD = Math.abs(dd);
    const deg = Math.floor(absDD);
    const min = Math.floor((absDD - deg) * 60);
    const sec = ((absDD - deg) * 3600 - min * 60).toFixed(2);
    
    document.getElementById(id + '_deg').value = (dd < 0 ? -deg : deg);
    document.getElementById(id + '_min').value = min;
    document.getElementById(id + '_sec').value = sec;
  };

  // DMS to DD è½‰æ›
  const dmsToD = (id) => {
    const d = parseFloat(document.getElementById(id + '_deg').value);
    const m = parseFloat(document.getElementById(id + '_min').value) || 0;
    const s = parseFloat(document.getElementById(id + '_sec').value) || 0;
    
    if (isNaN(d) && !m && !s) { document.getElementById(id).value = ''; return; }
    
    const sign = (d < 0) ? -1 : 1;
    const dd = sign * (Math.abs(d) + m / 60 + s / 3600);
    if (!isNaN(dd)) { document.getElementById(id).value = dd.toFixed(8); } else { document.getElementById(id).value = ''; }
  };
  
  // æ¸…é™¤å–®çµ„åº§æ¨™
  const clearCoord = (idPrefix) => {
    document.getElementById(idPrefix).value = '';
    ['deg', 'min', 'sec'].forEach(s => document.getElementById(idPrefix + '_' + s).value = '');
    const suffix = idPrefix.slice(-1);
    document.getElementById('ele' + suffix).value = '';
    document.getElementById('name' + suffix).value = '';
    calculate();
  };

  // Haversine è·é›¢ (çƒé¢æŠ•å½±è·é›¢, km)
  const hDist = (lat1, lon1, lat2, lon2) => {
    const [rLat1, rLat2, dLat, dLon] = [tRad(lat1), tRad(lat2), tRad(lat2 - lat1), tRad(lon2 - lon1)];
    const a = Math.sin(dLat / 2)**2 + Math.cos(rLat1) * Math.cos(rLat2) * Math.sin(dLon / 2)**2;
    return R_KM * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  };
  
  // 3D ç›´ç·šè·é›¢ (km)
  const straightDist = (hD, eleA, eleB) => {
    const dH = (eleB - eleA) / 1000;
    return Math.sqrt(hD * hD + dH * dH);
  };

  // æ–¹ä½è§’ (Bearing, 0-360Â°)
  const getBearing = (lat1, lon1, lat2, lon2) => {
    const [rL1, rL2, dLon] = [tRad(lat1), tRad(lat2), tRad(lon2 - lon1)];
    const y = Math.sin(dLon) * Math.cos(rL2);
    const x = Math.cos(rL1) * Math.sin(rL2) - Math.sin(rL1) * Math.cos(rL2) * Math.cos(dLon);
    return (tDeg(Math.atan2(y, x)) + 360) % 360;
  };
  
  // ä¿¯ä»°è§’ (Pitch Angle, åº¦)
  const getPitch = (distKm, eleA, eleB) => {
    if (distKm === 0) return { pitchAB: 0, pitchBA: 0 };
    const [hA, hB] = [eleA / 1000, eleB / 1000];
    const offset = distKm**2 / (2 * R_KM); 
    
    const H_AB = (hB - hA) - offset;
    const pitchAB = tDeg(Math.atan2(H_AB, distKm));
    
    const H_BA = (hA - hB) - offset;
    const pitchBA = tDeg(Math.atan2(H_BA, distKm));

    return { pitchAB, pitchBA };
  };


  // ä¸»è¨ˆç®—å‡½æ•¸
  function calculate() {
    const [latA, lonA, latB, lonB, eleA, eleB] = 
        ['latA', 'lonA', 'latB', 'lonB', 'eleA', 'eleB'].map(id => parseFloat(document.getElementById(id).value || 0));
    
    const [nameA, nameB] = 
        ['nameA', 'nameB'].map(id => document.getElementById(id).value || (id === 'nameA' ? 'A' : 'B'));

    const resDiv = document.getElementById('gpsRes');

    if (isNaN(latA) || isNaN(lonA) || isNaN(latB) || isNaN(lonB)) {
        resDiv.innerHTML = "âŒ **è«‹è¼¸å…¥æœ‰æ•ˆçš„ GPS åº§æ¨™æ•¸å­—**";
        resDiv.classList.add('gps-error');
        return;
    }
    resDiv.classList.remove('gps-error');

    const hD = hDist(latA, lonA, latB, lonB);
    const sD = straightDist(hD, eleA, eleB);
    const bAB = getBearing(latA, lonA, latB, lonB);
    const bBA = getBearing(latB, lonB, latA, lonA); 
    const pitch = getPitch(hD, eleA, eleB);
    
    const fDist = sD < 1 
        ? `<strong class="v-dist">${(sD * 1000).toFixed(2)}</strong> å…¬å°º`
        : `<strong class="v-dist">${sD.toFixed(2)}</strong> å…¬é‡Œ`;
    
    // é¡¯ç¤ºçµæœ
    resDiv.innerHTML = `
        <p>âœ… **å…©é»é–“çš„ç›´ç·šè·é›¢**ï¼š${fDist}</p>
        <hr>
        <p>ğŸ§­ **å¾ ${nameA} åˆ° ${nameB} çš„æ–¹ä½è§’**ï¼š<strong class="v-bearing">${bAB.toFixed(2)}Â°</strong></p>
        <p>â†©ï¸ **å¾ ${nameB} åˆ° ${nameA} çš„æ–¹ä½è§’**ï¼š<strong class="v-bearing">${bBA.toFixed(2)}Â°</strong></p>
        <hr style="border: 0; border-top: 1px dashed rgba(255,255,255,0.06); margin: 3px 0;">
        <p class="v-pitch-group">â« **${nameA} å° ${nameB} çš„ä¿¯ä»°è§’**ï¼š<strong class="v-pitch-value">${pitch.pitchAB.toFixed(2)}Â°</strong></p>
        <p class="gps-rpn">(æ­£å€¼å‘ä¸Šä»°æœ›ï¼Œè² å€¼å‘ä¸‹ä¿¯è¦–)</p>
        <p class="v-pitch-group">â¬ **${nameB} å° ${nameA} çš„ä¿¯ä»°è§’**ï¼š<strong class="v-pitch-value">${pitch.pitchBA.toFixed(2)}Â°</strong></p>
        <p class="gps-rpn">(æ­£å€¼å‘ä¸Šä»°æœ›ï¼Œè² å€¼å‘ä¸‹ä¿¯è¦–)</p>
    `;
  }
  
  // --- åˆå§‹åŒ–è¨­å®šèˆ‡åŸ·è¡Œ ---
  document.addEventListener('DOMContentLoaded', () => {
    // 1. RF è¨ˆç®—å™¨åˆå§‹åŒ–
    compute();

    // 2. GPS è¨ˆç®—å™¨åˆå§‹åŒ–é è¨­å€¼
    document.getElementById('latA').value = '23.123456'; 
    document.getElementById('lonA').value = '122.654321'; 
    document.getElementById('eleA').value = '50'; 
    document.getElementById('nameA').value = 'æ³°å±±å£“é ‚'; 
    document.getElementById('latB').value = '24.123456'; 
    document.getElementById('lonB').value = '121.654321'; 
    document.getElementById('eleB').value = '2000'; 
    document.getElementById('nameB').value = 'å…‰æ˜é ‚'; 
    
    dToDMS('latA'); dToDMS('lonA'); dToDMS('latB'); dToDMS('lonB');
    calculate(); 

    // 3. é è¨­é¡¯ç¤º RF Tab
    showTab('rf');
  });
</script>

</body>
</html>

